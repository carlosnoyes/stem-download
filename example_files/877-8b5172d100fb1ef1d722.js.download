(self.webpackChunkservices=self.webpackChunkservices||[]).push([[877],{300:function(t,e,n){"use strict";n.r(e);var r=n(73004),o={V1:r.default};e.default={create:function(t){if(t&&t.name)try{var e=t.name[0].toUpperCase()+t.name.slice(1);return new(o["V".concat(t.version||1)][e])(t)}catch(n){console.error("Tool name ".concat(t.name,", or tool version ").concat(t.version," is not supported"))}else console.error("Tool must be passed with at least name")}}},5244:function(t,e,n){"use strict";n.r(e);var r=n(26428),o=n(64519),i=function(){function t(t,e,n){this.storage=t,this.attributes=e,this.project=new r.default(n)}var e=t.prototype;return e.setProject=function(t){this.project=new r.default(t)},e.addDrawing=function(t,e,n,r){return this.project.addDrawing(t,e,n,r)},e.doneDrawing=function(){this.save()},e.refreshDrawings=function(t,e){this.project.refreshDrawings(t,e)},e.addEraser=function(t,e,n){this.project.addEraser(t,e,n),this.save()},e.addText=function(t,e,n,r){this.project.addText(t,e,n,r)},e.clearAnnotations=function(t){return this.project.clearCanvas(t),this.save()},e.save=function(){if(this.attributes.mine)return this.project.cull(),this.project.isEmpty()?this._delete():this._save();console.warn("Attempting to save an annotation that is not mine!")},e._save=function(){var t=this;return this.storage.upload((0,o.deflate)(this.project)).then(function(e){return t.storage.associate(t._payload(),e).then(function(e){var n=e.data.id;return t.attributes.id=parseInt(n,10),Promise.resolve(!0)})})},e._delete=function(){return this.attributes.id?this.storage.delete(this._payload()).then(function(){return Promise.resolve(!1)}):Promise.resolve(!1)},e._payload=function(){return{attachmentId:this.attributes.attachment_id,drawingId:this.attributes.id}},e.drawOn=function(t,e){this.project.drawOn(t,e)},t}();e.default=i},9182:function(t,e,n){"use strict";n.r(e);var r=n(80747);function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(){function t(t){var e=this;this.handleMouseUp=function(){e.dragging||e.focused?!e.dragging&&e.focused&&(e.exitMoveMode(),e.enterEditMode()):e.focused=!0},this.handleMouseDown=function(t){var n=t.clientX,r=t.clientY;e.originalY=r,e.originalX=n,$("body").on("mousemove.annotation_".concat(e.textID),e.handleBodyMousemove)},this.handleBodyMousemove=function(t){var n=t.clientX,r=t.clientY,o="".concat(e.y+r-e.originalY,"px"),i="".concat(e.x+n-e.originalX,"px");$(".annotation_".concat(e.textID)).css({top:o,left:i}),e.dragging=!0,e.focused=!0},this.handleBodyMouseup=function(){e.dragging&&(e.dragging=!1,e.x=parseFloat(e.$input.css("left")),e.y=parseFloat(e.$input.css("top")),e.onApplyChanges(e)),$("body").off("mousemove.annotation_".concat(e.textID))},this.applyAndExitMoveMode=function(){e.onApplyChanges(e),e.exitMoveMode(),e.onExitEditMode()},this.handleBodyClick=function(t){$(t.target).is(".annotation_".concat(e.textID))||(music_stand.annotater.ignoreMouseUp=!0,e.applyAndExitMoveMode())},this.handleKeyDown=function(t){t.preventDefault(),t.stopPropagation(),8!==t.keyCode&&46!==t.keyCode||(e.value="",e.applyAndExitMoveMode()),13===t.keyCode&&(e.$input.get(0).selectionStart=e.value.length,e.exitMoveMode(),e.enterEditMode()),27===t.keyCode&&(e.$input.blur(),e.applyAndExitMoveMode())};var n=$(".annotation_".concat(t.textID));Object.assign(this,i(i({},t),{},{$input:n,dragging:!1,x:parseFloat(n.css("left")),y:parseFloat(n.css("top"))})),this.bindHandlers(),this.applyStyles()}var e=t.prototype;return e.applyStyles=function(){this.$input.css({color:"transparent",textShadow:"0px 0px 0px ".concat(this.color),border:"solid 1px blue",cursor:"default",outline:"none"})},e.removeStyles=function(){this.$input.css({color:"".concat(this.color),textShadow:"none",border:"solid 1px transparent",cursor:"default"})},e.bindHandlers=function(){this.$input.on("mousedown.annotation_".concat(this.textID),this.handleMouseDown),this.$input.on("mouseup.annotation_".concat(this.textID),this.handleMouseUp),this.$input.on("keydown.handleKeyDown",this.handleKeyDown),$("body").on("mousemove.annotation_".concat(this.textID),this.handleBodyMousemove),$("body").on("mouseup.annotation_".concat(this.textID),this.handleBodyMouseup),$(window).off("resize.selectedText_".concat(this.textID)).on("resize.selectedText_".concat(this.textID),this.applyAndExitMoveMode),$("body").off("mousedown.annotation_".concat(this.textID)).on("mousedown.annotation_".concat(this.textID),"#pages_container",this.handleBodyClick)},e.exitMoveMode=function(){this.removeStyles(),this.$input.off("mousedown.annotation_".concat(this.textID)),this.$input.off("mouseup.annotation_".concat(this.textID)),this.$input.off("keydown.handleKeyDown"),$("body").off("mouseup.annotation_".concat(this.textID)),$("body").off("mousedown.annotation_".concat(this.textID)),$("body").off("mousemove.annotation_".concat(this.textID)),$(window).off("resize.annotation_".concat(this.textID)),$(window).off("resize.selectedText_".concat(this.textID))},e.enterEditMode=function(){new r.default({originalX:this.clientX,originalY:this.clientY,color:this.color,textID:this.textID,fontSize:this.fontSize,fontName:this.fontName,value:this.value,onApplyChanges:this.onApplyChanges,onExitEditMode:this.onExitEditMode})},t}();e.default=s},13367:function(t,e,n){"use strict";n.r(e),e.default=function(t,e){var n=e.height;return Math.max(1,n*t)}},15850:function(t,e,n){"use strict";n.r(e);var r=n(39339),o=function(){function t(t){var e=t.x,n=t.y;this.x=e,this.y=n}return t.prototype.toOffset=function(t){var e=t.height,n=t.width,o=this.x/n,i=this.y/e;return new r.default({xOffset:o,yOffset:i})},t}();e.default=o},26009:function(t,e,n){"use strict";n.r(e);var r=n(68414),o=n.n(r),i=n(94305),a=n(39339),s=n(38974);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=function(){function t(t){this._type="text",this.version=1,this.DEFAULT_COLOR="black",this.DEFAULT_FONT_NAME="Arial",this.DEFAULT_FONT_SIZE=.025,this.DEFAULT_LOCATION={xOffset:0,yOffset:0},this.DEFAULT_VALUE="",t=t||{},this.fontName=t.fontName||this.DEFAULT_FONT_NAME,this.fontSize=t.fontSize||this.DEFAULT_FONT_SIZE,this.location=new a.default(t.location)||this.DEFAULT_LOCATION,this.textID=t.textID||o().v4(),this.value=t.value||this.DEFAULT_VALUE,this.domText=null,t.color?t.color.name?this.color=s.default.Colors.named({name:t.color.name}):this.color=t.color:this.color=s.default.Colors.named({name:this.DEFAULT_COLOR})}var e=t.prototype;return e.applyChanges=function(t,e){var n=t.color,r=t.fontName,o=t.fontSize,i=t.value,a=t.x,c=t.y;this.location=new s.default.PixelPoint({x:a,y:c}).toOffset(e),this.fontName=r,this.fontSize=o,this.value=i,this.color=s.default.Colors.named({name:n})},e.point=function(t){return new a.default(this.location).toPixelPoint(t)},e.cull=function(){this.isEmpty()&&this.domText&&this.domText.remove()},e.isEmpty=function(){return!this.value.trim().length},e.drawOn=function(t,e){this.domText=new i.default(t.canvas,this.cloner(e),e,this.applyChanges.bind(this))},e.cloner=function(t){var e=this;return function(){return u(u({},e),{},{point:e.point(t),color:e.color.name})}},e.toJson=function(){return{_type:this._type,version:this.version,color:this.color,fontName:this.fontName,fontSize:this.fontSize,location:this.location,textID:this.textID,value:this.value}},t}();e.default=f},26428:function(t,e,n){"use strict";n.r(e);var r=n(2543),o=n.n(r),i=n(95526),a=n(54164),s=n(38974);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var l=function(){function t(t){this._type="project",t=t||{},this.header=a.default.create(t.header),this.canvases=(t.canvases||[]).map(i.default.create)}var e=t.prototype;return e.addDrawing=function(t,e,n,r){var o=new s.default.PixelPoint(n).toOffset(e),i=new s.default.Point({location:o}),a=this._getOrCreateCanvas(r).addDrawing(t,i);return a.drawOn(this._setupContext(e),e),a},e.addEraser=function(t,e,n){var r=e.map(function(e){return new s.default.PixelPoint(e).toOffset(t)}),o=[new s.default.Point({location:r[0]}),new s.default.Point({location:r[1],previous:r[0]})];this._getOrCreateCanvas(n).addEraser(o).drawOn(this._setupContext(t),t)},e.addText=function(t,e,n,r){var o=new s.default.PixelPoint(n).toOffset(e),i=this._getOrCreateCanvas(r).addText(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({location:o},t));i.drawOn(this._setupContext(e),e),$(".annotation_".concat(i.textID)).focus().mousedown(),$("body").mouseup()},e.clearCanvas=function(t){this.canvases=this.canvases.filter(function(e){return e.index!==t})},e.cull=function(){this.canvases.forEach(function(t){return t.cull()}),this.canvases=this.canvases.filter(function(t){return!t.isEmpty()})},e.isEmpty=function(){return!this.canvases.length},e.drawOn=function(t,e){var n=this._getCanvas(e);n&&n.drawOn(this._setupContext(t),t)},e.refreshDrawings=function(t,e){var n=this._getCanvas(e);n&&n.refreshDrawings(this._setupContext(t),t)},e.toJson=function(){return{_type:this._type,header:this.header.toJson(),canvases:this.canvases.map(function(t){return t.toJson()})}},e._getOrCreateCanvas=function(t){var e=this._getCanvas(t);return e||this._createCanvas(t)},e._createCanvas=function(t){var e=i.default.create({index:t});return this.canvases.push(e),e},e._getCanvas=function(t){return o().find(this.canvases,function(e){return e.index===t})},e._setupContext=function(t){var e=t.getContext("2d");return e.lineCap="round",e.lineJoin="round",e.miterLimit=2,e},t}();e.default=l},27556:function(t,e,n){"use strict";n.r(e);var r=["name"];var o={black:{name:"black",red:0,green:0,blue:0,alpha:1},blue:{name:"blue",red:0,green:0,blue:255,alpha:1},green:{name:"green",red:0,green:128,blue:0,alpha:1},orange:{name:"orange",red:255,green:127,blue:0,alpha:1},purple:{name:"purple",red:128,green:0,blue:128,alpha:1},red:{name:"red",red:255,green:0,blue:0,alpha:1},white:{name:"white",red:255,green:255,blue:255,alpha:1},yellow:{name:"yellow",red:255,green:255,blue:0,alpha:1},clear:{name:"clear",red:0,green:0,blue:0,alpha:0},aqua:{name:"aqua",red:0,green:255,blue:255,alpha:1},fuchsia:{name:"fuchsia",red:255,green:0,blue:255,alpha:1},lime:{name:"lime",red:0,green:255,blue:0,alpha:1}},i=function(t){var e=t.red,n=t.green,r=t.blue,o=t.alpha;return"rgba(".concat(e,", ").concat(n,", ").concat(r,", ").concat(o>1?o/255:o,")")};e.default={colors:function(t){var e=t.name,n=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(t,r);return i(o[e]?o[e]:n)},named:function(t){var e=t.name;return o[e]},toRGBA:i}},27927:function(t,e,n){"use strict";n.r(e);var r=n(39339);function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var a=function(t,e){return[(t.x+e.x)/2,(t.y+e.y)/2]},s=function(){function t(t,e){this.pathPoints=t.map(function(t){return{location:new r.default(t.location).toPixelPoint(e),previous:new r.default(t.previous).toPixelPoint(e)}})}return t.prototype.drawOn=function(t){!function(t,e){if(!e.length)throw new Error("Cannot create a path without any points");t.beginPath();var n=e[0].previous;if(t.moveTo(n.x,n.y),e.length<4)for(var r=0;r<e.length;r++){var i=e[r].location;t.lineTo(i.x,i.y)}else for(r=2;r<e.length;r++){var s=e[r-1].location,c=e[r].location,u=o(a(s,c),2),l=u[0],f=u[1];t.quadraticCurveTo(s.x,s.y,l,f)}t.stroke()}(t,this.pathPoints)},t}();e.default=s},38974:function(t,e,n){"use strict";n.r(e);var r=n(27556),o=n(39339),i=n(27927),a=n(15850),s=n(79852),c=n(13367);e.default={Colors:r.default,Offset:o.default,Path:i.default,PixelPoint:a.default,Point:s.default,calcLineWidth:c.default}},39339:function(t,e,n){"use strict";n.r(e);var r=n(15850),o=function(){function t(t){var e=t.xOffset,n=t.yOffset;this.xOffset=e,this.yOffset=n}return t.prototype.toPixelPoint=function(t){var e=t.width,n=t.height,o=this.xOffset*e,i=this.yOffset*n;return new r.default({x:o,y:i})},t}();e.default=o},53291:function(t,e,n){"use strict";n.r(e);var r=n(75920),o=n(38974);function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,a(r.key),r)}}function a(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}var c=function(t){var e,n;function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).DEFAULT_COLOR="black",e}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,s(e,n),r.prototype.drawOn=function(t,e,n){t.lineWidth=o.default.calcLineWidth(this.lineWidth,e),t.strokeStyle=o.default.Colors.colors(n.color);var r=n.points.filter(function(t){return!t.isPredictive});new o.default.Path(r,e).drawOn(t)},function(t,e,n){e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1})}(r,[{key:"defaultColor",get:function(){return o.default.Colors.named({name:this.DEFAULT_COLOR})}}]),r}(r.default);e.default=c},53484:function(t,e,n){"use strict";var r=n(36213);e.A=function(){$.ajaxPrefilter(function(t,e,n){_.startsWith(t.url,(0,r.A)("api"))&&$.rails.CSRFProtection(n)})}},54164:function(t,e,n){"use strict";n.r(e);var r=n(90443),o={V1:r.default};e.default={create:function(t){if(!t)return new(o["V".concat(1)])(t);try{return new(o["V".concat(t.version)])(t)}catch(e){console.error("Header version ".concat(t.version," is not supported"))}}}},55756:function(){!function(t,e){"use strict";var n;t.rails!==e&&t.error("jquery-ujs has already been loaded!");var r=t(document);t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return t("meta[name=csrf-token]").attr("content")},csrfParam:function(){return t("meta[name=csrf-param]").attr("content")},CSRFProtection:function(t){var e=n.csrfToken();e&&t.setRequestHeader("X-CSRF-Token",e)},refreshCSRFTokens:function(){t('form input[name="'+n.csrfParam()+'"]').val(n.csrfToken())},fire:function(e,n,r){var o=t.Event(n);return e.trigger(o,r),!1!==o.result},confirm:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return confirm(t)}),ajax:function(e){return t.ajax(e)},href:function(t){return t[0].href},isRemote:function(t){return t.data("remote")!==e&&!1!==t.data("remote")},handleRemote:function(r){var o,i,a,s,c,u;if(n.fire(r,"ajax:before")){if(s=r.data("with-credentials")||null,c=r.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,r.is("form")){o=r.attr("method"),i=r.attr("action"),a=r.serializeArray();var l=r.data("ujs:submit-button");l&&(a.push(l),r.data("ujs:submit-button",null))}else r.is(n.inputChangeSelector)?(o=r.data("method"),i=r.data("url"),a=r.serialize(),r.data("params")&&(a=a+"&"+r.data("params"))):r.is(n.buttonClickSelector)?(o=r.data("method")||"get",i=r.data("url"),a=r.serialize(),r.data("params")&&(a=a+"&"+r.data("params"))):(o=r.data("method"),i=n.href(r),a=r.data("params")||null);return u={type:o||"GET",data:a,dataType:c,beforeSend:function(t,o){if(o.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),!n.fire(r,"ajax:beforeSend",[t,o]))return!1;r.trigger("ajax:send",t)},success:function(t,e,n){r.trigger("ajax:success",[t,e,n])},complete:function(t,e){r.trigger("ajax:complete",[t,e])},error:function(t,e,n){r.trigger("ajax:error",[t,e,n])},crossDomain:n.isCrossDomain(i)},s&&(u.xhrFields={withCredentials:s}),i&&(u.url=i),n.ajax(u)}return!1},isCrossDomain:function(t){var e=document.createElement("a");e.href=location.href;var n=document.createElement("a");try{return n.href=t,n.href=n.href,!((!n.protocol||":"===n.protocol)&&!n.host||e.protocol+"//"+e.host===n.protocol+"//"+n.host)}catch(r){return!0}},handleMethod:function(r){var o=n.href(r),i=r.data("method"),a=r.attr("target"),s=n.csrfToken(),c=n.csrfParam(),u=t('<form method="post" action="'+o+'"></form>'),l='<input name="_method" value="'+i+'" type="hidden" />';c===e||s===e||n.isCrossDomain(o)||(l+='<input name="'+c+'" value="'+s+'" type="hidden" />'),a&&u.attr("target",a),u.hide().append(l).appendTo("body"),u.submit()},formElements:function(e,n){return e.is("form")?t(e[0].elements).filter(n):e.find(n)},disableFormElements:function(e){n.formElements(e,n.disableSelector).each(function(){n.disableFormElement(t(this))})},disableFormElement:function(t){var n,r;n=t.is("button")?"html":"val",r=t.data("disable-with"),t.data("ujs:enable-with",t[n]()),r!==e&&t[n](r),t.prop("disabled",!0)},enableFormElements:function(e){n.formElements(e,n.enableSelector).each(function(){n.enableFormElement(t(this))})},enableFormElement:function(t){var e=t.is("button")?"html":"val";"undefined"!==typeof t.data("ujs:enable-with")&&t[e](t.data("ujs:enable-with")),t.prop("disabled",!1)},allowAction:function(t){var e,r=t.data("confirm"),o=!1;if(!r)return!0;if(n.fire(t,"confirm")){try{o=n.confirm(r)}catch(i){(console.error||console.log).call(console,i.stack||i)}e=n.fire(t,"confirm:complete",[o])}return o&&e},blankInputs:function(e,n,r){var o,i=t(),a=n||"input,textarea",s=e.find(a);return s.each(function(){if(o=t(this),(o.is("input[type=checkbox],input[type=radio]")?o.is(":checked"):!!o.val())===r){if(o.is("input[type=radio]")&&s.filter('input[type=radio]:checked[name="'+o.attr("name")+'"]').length)return!0;i=i.add(o)}}),!!i.length&&i},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(t){var r=t.data("disable-with");t.data("ujs:enable-with",t.html()),r!==e&&t.html(r),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.removeData("ujs:enable-with")),t.unbind("click.railsDisable")}},n.fire(r,"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,r){t.crossDomain||n.CSRFProtection(r)}),t(window).on("pageshow.rails",function(){t(t.rails.enableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableFormElement(e)}),t(t.rails.linkDisableSelector).each(function(){var e=t(this);e.data("ujs:enable-with")&&t.rails.enableElement(e)})}),r.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),r.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(t(this))}),r.delegate(n.linkClickSelector,"click.rails",function(e){var r=t(this),o=r.data("method"),i=r.data("params"),a=e.metaKey||e.ctrlKey;if(!n.allowAction(r))return n.stopEverything(e);if(!a&&r.is(n.linkDisableSelector)&&n.disableElement(r),n.isRemote(r)){if(a&&(!o||"GET"===o)&&!i)return!0;var s=n.handleRemote(r);return!1===s?n.enableElement(r):s.fail(function(){n.enableElement(r)}),!1}return o?(n.handleMethod(r),!1):void 0}),r.delegate(n.buttonClickSelector,"click.rails",function(e){var r=t(this);if(!n.allowAction(r)||!n.isRemote(r))return n.stopEverything(e);r.is(n.buttonDisableSelector)&&n.disableFormElement(r);var o=n.handleRemote(r);return!1===o?n.enableFormElement(r):o.fail(function(){n.enableFormElement(r)}),!1}),r.delegate(n.inputChangeSelector,"change.rails",function(e){var r=t(this);return n.allowAction(r)&&n.isRemote(r)?(n.handleRemote(r),!1):n.stopEverything(e)}),r.delegate(n.formSubmitSelector,"submit.rails",function(r){var o,i,a=t(this),s=n.isRemote(a);if(!n.allowAction(a))return n.stopEverything(r);if(a.attr("novalidate")===e&&(o=n.blankInputs(a,n.requiredInputSelector,!1))&&n.fire(a,"ajax:aborted:required",[o]))return n.stopEverything(r);if(s){if(i=n.nonBlankInputs(a,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(a)},13);var c=n.fire(a,"ajax:aborted:file",[i]);return c||setTimeout(function(){n.enableFormElements(a)},13),c}return n.handleRemote(a),!1}setTimeout(function(){n.disableFormElements(a)},13)}),r.delegate(n.formInputClickSelector,"click.rails",function(e){var r=t(this);if(!n.allowAction(r))return n.stopEverything(e);var o=r.attr("name"),i=o?{name:o,value:r.val()}:null;r.closest("form").data("ujs:submit-button",i)}),r.delegate(n.formSubmitSelector,"ajax:send.rails",function(e){this===e.target&&n.disableFormElements(t(this))}),r.delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this===e.target&&n.enableFormElements(t(this))}),t(function(){n.refreshCSRFTokens()}))}(jQuery)},56733:function(t,e,n){"use strict";n.r(e);var r=n(5244),o=n(83601);e.default={Annotations:r.default,API:o.default}},58785:function(t,e,n){"use strict";n.r(e);var r=n(89980),o=n(38974),i={V1:r.default};e.default={create:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!t.version)return new(i["V".concat(1)])(t);try{return new(i["V".concat(t.version)])(t)}catch(e){console.error("Drawing version ".concat(t.version," is not supported"))}},Utils:o.default}},64519:function(t,e,n){"use strict";n.r(e),n.d(e,{deflate:function(){return s},inflate:function(){return c},setDimensions:function(){return a}});var r=n(51668),o=n.n(r),i=n(52592),a=function(t){var e=t.get(0),n=(0,i.A)(e.value,e);t.prop({rows:1}),t.css({height:1}),t.css({width:Math.max(n+10,30)}),t.css({height:e.scrollHeight})},s=function(t){return o().deflate(JSON.stringify(t.toJson()))},c=function(t){return JSON.parse(o().inflate(t,{to:"string"}))}},73004:function(t,e,n){"use strict";n.r(e);var r=n(76306),o=n(90511),i=n(53291);e.default={Eraser:r.default,Highlighter:o.default,Pen:i.default}},75920:function(t,e,n){"use strict";n.r(e);var r=n(38974);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}function i(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var a=function(){function t(t){this._type="tool",this.version=1,this.DEFAULT_COLOR="black",this.DEFAULT_LINE_WIDTH=.0025,this.name=t.name,this.lineWidth=t.lineWidth||this.DEFAULT_LINE_WIDTH,this.forceSensitivity=t.forceSensitivity||1}var e,n,i;return t.prototype.toJson=function(){return{_type:this._type,version:this.version,forceSensitivity:this.forceSensitivity,lineWidth:this.lineWidth,name:this.name}},e=t,(n=[{key:"defaultColor",get:function(){return r.default.Colors.named({name:this.DEFAULT_COLOR})}}])&&o(e.prototype,n),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=a},76306:function(t,e,n){"use strict";n.r(e);var r=n(75920),o=n(38974);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var a=function(t){var e,n;function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).DEFAULT_COLOR="clear",e.DEFAULT_LINE_WIDTH=.005,e}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,i(e,n),r.prototype.drawOn=function(t,e,n){if(t.lineWidth=o.default.calcLineWidth(this.lineWidth,e),n.points.length>=2){var r=n.points[0].location,i=new o.default.Offset(r).toPixelPoint(e),a=n.points[n.points.length-1].location,s=new o.default.Offset(a).toPixelPoint(e);t.clearRect(i.x,i.y,s.x-i.x,s.y-i.y)}},r}(r.default);e.default=a},79852:function(t,e,n){"use strict";n.r(e);var r=n(39339),o=function(){function t(t){this._type="point",t=t||{},this.force=t.force||1,this.isPredictive=t.isPredictive||!1,this.previous=new r.default(t.previous||t.location),this.location=new r.default(t.location)}return t.prototype.toJson=function(){return{_type:this._type,force:this.force,isPredictive:this.isPredictive,previous:this.previous,location:this.location}},t}();e.default=o},80747:function(t,e,n){"use strict";n.r(e);var r=n(64519);function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach(function(e){a(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var s=function(t){var e=t.top;return e+(t.bottom-e)/2},c=function(){function t(t){var e=this;this.handleFontSizeClick=function(t){var n=t.target;e.fontSize=$(n).data("size"),$("#font-size li").removeClass("active"),$(n).addClass("active"),e.$input.css("fontSize",e.fontSize*e.$input.parent().height()),e.$input.focus(),(0,r.setDimensions)(e.$input)},this.handleFontFamilyClick=function(t){var n=t.target;e.fontName=$(n).data("font"),$("#font-family li").removeClass("active"),$(n).addClass("active"),e.$input.css("fontFamily",e.fontName),e.$input.focus(),(0,r.setDimensions)(e.$input)},this.handleColorClick=function(t){var n=t.target,r=$(n).data("color");e.color=r,e.$input.css("color",r),e.$input.focus()},this.applyAndExitEditMode=function(){e.value=e.$input.val().trim(),e.onApplyChanges(e),e.exitEditMode()},this.handleBodyClick=function(t){$(t.target).is(".annotation_".concat(e.textID))||(music_stand.annotater.ignoreMouseUp=!0,e.applyAndExitEditMode())},this.handleKeyUp=function(t){var n=t.keyCode,o=t.target;27===n&&(o.value=e.value,""===e.$input.val().trim()?e.$input.remove():e.$input.blur(),(0,r.setDimensions)(e.$input),e.exitEditMode())};var n=$(".annotation_".concat(t.textID));Object.assign(this,i(i({},t),{},{$input:n,x:parseFloat(n.css("left")),y:parseFloat(n.css("top"))})),this.showTextToolbar(),this.bindHandlers(),this.applyStyles()}var e=t.prototype;return e.applyStyles=function(){this.$input.css({outline:"3px solid #ccc"})},e.removeStyles=function(){this.$input.css({outline:""})},e.showTextToolbar=function(){var t=this;$("#text_selector").show("fast",function(){var e=$("#text_selector").get(0).getBoundingClientRect(),n=t.$input.get(0).getBoundingClientRect();(function(t,e){return(t.top<e.top&&t.bottom>e.top||t.bottom>e.bottom&&t.top<e.bottom)&&(t.left<e.left&&t.right>e.left||t.right>e.right&&t.left<e.right)})(e,n)&&(s(e)>s(n)?$("#text_selector").animate({top:n.bottom+5}):$("#text_selector").animate({top:0}))}),$('[data-tool="pen"], [data-tool="highlighter"], [data-tool="rectangle"], #diameter_wrap').off("click.applyAndExitEditMode").on("click.applyAndExitEditMode",this.applyAndExitEditMode),$("#font-size li").off("click").on("click",this.handleFontSizeClick),$("#font-family li").off("click").on("click",this.handleFontFamilyClick),$("#general_colors a").off("click.colorClick").on("click.colorClick",this.handleColorClick),music_stand.annotater.toolClicked({color:this.color}),this.highlightSelectedTools()},e.highlightSelectedTools=function(){var t;$("#font-family li").removeClass("active"),$("#font-size li").removeClass("active"),$('#font-family li[data-font="'.concat(this.fontName,'"]')).addClass("active"),$('#font-size li[data-size="'.concat((t=this.fontSize,t<=.02?.015:t<=.035?.025:.045),'"]')).addClass("active")},e.bindHandlers=function(){var t=this;this.$input.off("input.handleInput").on("input.handleInput",function(){return(0,r.setDimensions)(t.$input)}).off("keyup.handleKeyUp").on("keyup.handleKeyUp",this.handleKeyUp),$(window).off("resize.annotation_".concat(this.textID)).on("resize.annotation_".concat(this.textID),this.applyAndExitEditMode),$("body").off("mousedown.annotation_".concat(this.textID)).on("mousedown.annotation_".concat(this.textID),"#pages_container",this.handleBodyClick).off("mousedown","#footerbar").on("mousedown","#footerbar",this.handleBodyClick)},e.exitEditMode=function(){$("#text_selector").animate({top:75}).hide("fast"),$("#font-size li").off("click"),$("#font-family li").off("click"),$("#general_colors a").off("click.colorClick"),$("body").off("mouseup.annotation_".concat(this.textID)),$("body").off("mousedown.annotation_".concat(this.textID)),$(window).off("resize.annotation_".concat(this.textID)),this.$input.off("input.handleInput"),this.$input.off("keyup.handleKeyUp"),this.onExitEditMode(),this.removeStyles()},t}();e.default=c},83310:function(t,e,n){"use strict";n.r(e);var r=n(26009),o={V1:r.default};e.default={create:function(t){if(!t.version)return new(o["V".concat(1)])(t);try{return new(o["V".concat(t.version)])(t)}catch(e){console.error("Text version ".concat(t.version," is not supported"))}}}},83601:function(t,e,n){"use strict";n.r(e);var r=n(64519),o=n(36213),i=["drawingId"];function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function l(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=function(t){var e=t.planId,n=t.serviceTypeId,r=t.attachmentId;return"".concat((0,o.A)("api"),"/services/v2/service_types/").concat(n,"/plans/").concat(e,"/all_attachments/").concat(r)},d=function(t){var e=t.drawingId,n=function(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(t,i),r=e?"/".concat(e):"";return"".concat(f(n),"/drawings").concat(r)},p=function(t){return{data:{attributes:{file_upload_identifier:t}}}},h=function(t){return{data:{attributes:{error_code:t}}}};e.default=function(t){var e=this,n=t.plan_id,i=t.service_type_id;this.inflate=r.inflate,this.get=function(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.onload=function(t){if(/^20\d/.test(r.status))try{e(r.response)}catch(t){n(t)}else n(t)},r.onerror=n,r.open("GET",t),r.responseType="arraybuffer",r.send()})},this.upload=function(t){return new Promise(function(e,n){var r=new XMLHttpRequest,i="".concat((0,o.A)("upload"),"/v2/files"),a=new FormData;a.append("file",new Blob([t]),"drawing.zlib"),r.onload=function(t){if(/^20\d/.test(r.status))try{e(JSON.parse(r.response))}catch(t){n(t)}else n(t)},r.onerror=n,r.open("POST",i),r.withCredentials=!0,r.send(a)})},this.delete=function(t){var n=t.attachmentId,r=t.drawingId;return new Promise(function(t,o){$.ajax({type:"DELETE",url:"".concat(d(u(u({},e),{},{attachmentId:n,drawingId:r})),"?per_page=100"),xhrFields:{withCredentials:!0},success:t,error:o})})},this.associate=function(t,n){var r=t.attachmentId,o=t.drawingId,i=a(n.data,1)[0].id;return new Promise(function(t,n){$.ajax({type:o?"PATCH":"POST",url:"".concat(d(u(u({},e),{},{attachmentId:r,drawingId:o})),"?per_page=100"),data:JSON.stringify(p(i)),xhrFields:{withCredentials:!0},success:t,error:n})})},this.getDrawings=function(t){var n=t.attachmentId;return new Promise(function(t,r){$.ajax({type:"GET",url:d(u(u({},e),{},{attachmentId:n})),xhrFields:{withCredentials:!0},success:t,error:r})})},this.openAttachment=function(t){var n=t.attachmentId;return new Promise(function(t,r){var o;$.ajax({type:"POST",url:(o=u(u({},e),{},{attachmentId:n}),"".concat(f(o),"/open")),xhrFields:{withCredentials:!0},success:t,error:r})})},this.openDrawing=function(t){var n=t.attachmentId,r=t.drawingId;return new Promise(function(t,o){var i;$.ajax({type:"POST",url:(i=u(u({},e),{},{attachmentId:n,drawingId:r}),"".concat(d(i),"/open")),xhrFields:{withCredentials:!0},success:t,error:o})})},this.pdfForError=function(t){var n=t.attachmentId,r=t.errorCode;return new Promise(function(t,o){var i;$.ajax({type:"POST",url:(i=u(u({},e),{},{attachmentId:n}),"".concat(f(i),"/pdf_error")),xhrFields:{withCredentials:!0},data:JSON.stringify(h(r)),success:function(n){var r=n.data.attributes.attachment_url;return e.get(r).then(t).catch(o)},error:o})})},this.planId=n,this.serviceTypeId=i}},89980:function(t,e,n){"use strict";n.r(e);var r=n(68414),o=n.n(r),i=n(38974),a=n(300),s=function(){function t(t){this._type="drawing",this.version=1,t=t||{},this.isCulled=t.isCulled||!1,this.isSmoothingEnabled=t.isSmoothingEnabled||!1,this.drawingID=t.drawingID||o().v4(),this.tool=a.default.create(t.tool),this.points=t.points?t.points.map(function(t){return new i.default.Point(t)}):[],t.color?t.color.name?this.color=i.default.Colors.named({name:t.color.name}):this.color=t.color:this.color=this.tool.defaultColor}var e=t.prototype;return e.addPoint=function(t,e){var n=t.getContext("2d");n.lineCap="round",n.lineJoin="round",n.miterLimit=2;var r=this.points[this.points.length-1].location,o=new i.default.PixelPoint(e).toOffset(t),a=new i.default.Point({location:o,previous:r});this.points.push(a),this.drawOn(n,t)},e.drawOn=function(t,e){this.tool.drawOn(t,e,this)},e.toJson=function(){return{_type:this._type,version:this.version,isCulled:this.isCulled,isSmoothingEnabled:this.isSmoothingEnabled,drawingID:this.drawingID,points:this.points.map(function(t){return t.toJson()}),color:this.color,tool:this.tool.toJson()}},t}();e.default=s},90443:function(t,e,n){"use strict";n.r(e);var r=n(68414),o=n.n(r),i=function(){function t(t){this._type="header",this.version=1,t=t||{},this.projectID=t.projectID||o().v4()}return t.prototype.toJson=function(){return{_type:this._type,version:this.version,projectID:this.projectID}},t}();e.default=i},90511:function(t,e,n){"use strict";n.r(e);var r=n(75920),o=n(38974);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach(function(e){c(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function c(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(t){var e,n;function r(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).DEFAULT_COLOR="yellow",e.DEFAULT_LINE_WIDTH=.04,e}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,i(e,n),r.prototype.drawOn=function(t,e,n){var r,i;t.lineWidth=o.default.calcLineWidth(this.lineWidth,e),t.strokeStyle=(r=n.color,i=o.default.Colors.named(r),o.default.Colors.toRGBA(s(s({},i||r),{},{alpha:.2})));var a=n.points.filter(function(t){return!t.isPredictive});new o.default.Path(a,e).drawOn(t)},r}(r.default);e.default=u},94305:function(t,e,n){"use strict";n.r(e);var r=n(64519),o=n(80747),i=n(9182),a=function(){function t(t,e,n,o){var i=$(t);this.attachmentId=i.siblings("img").data("attachment-id"),this.isEditing=!1,this.$node=this.create(e,n,o),i.after(this.$node),(0,r.setDimensions)(this.$node)}var e=t.prototype;return e.remove=function(){this.$node.remove()},e.create=function(t,e,n){var r=this,a=t(),s=a.point,c=a.fontSize,u=a.fontName,l=a.color,f=a.textID,d=a.value,p=$('<textarea class="text_annotation annotation_'.concat(f,'" />')).css({backgroundColor:"transparent",border:"solid 1px transparent",position:"absolute",cursor:"default",top:s.y,left:s.x,color:l,fontSize:c*e.height,fontFamily:u}).val(d);return p.mousedown(function(a){var s=a.clientX,c=a.clientY,u=a.target;if("text"!==music_stand.annotater.tool){var l=$(u).parent();return music_stand.annotater.mouseDown(s-l[0].offsetLeft,c-l[0].offsetTop-11,l),!1}if(!r.isEditing){var f=t(),d=f.fontSize,p=f.fontName,h=f.color,m=f.textID,v=f.value,b=""===v?o.default:i.default;r.isEditing=!0,new b({originalX:s,originalY:c,color:h,textID:m,fontSize:d,fontName:p,value:v,onApplyChanges:function(t){n(t,e),$("body").trigger("SaveMyAnnotations",[r.attachmentId])},onExitEditMode:function(){return r.isEditing=!1}})}}),p.mousemove(function(t){var e=t.clientX,n=t.clientY,r=t.target,o=$(r).parent();music_stand.annotater.mouseMove(e-o[0].offsetLeft,n-o[0].offsetTop-11,o)}),p.mouseover(function(t){var e=t.target;"text"!==music_stand.annotater.tool||r.isEditing||$(e).css({border:"solid 1px #ccc",cursor:"pointer"})}),p.mouseout(function(t){var e=t.target;"text"!==music_stand.annotater.tool||r.isEditing||$(e).css({border:"solid 1px transparent",cursor:"default"})}),p},t}();e.default=a},95526:function(t,e,n){"use strict";n.r(e);var r=n(58785),o=n(83310),i=["color"],a=["color"];function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function c(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var l=function(){function t(t){var e=t.index,n=t.text,i=void 0===n?[]:n,a=t.drawings,s=void 0===a?[]:a;this._type="canvas",this.index=e,this.text=i.map(o.default.create),this.drawings=s.map(r.default.create)}var e=t.prototype;return e.addDrawing=function(t,e){var n=t.color,o=u(t,i),a=r.default.create({tool:o,points:[e],color:{name:n}});return this.drawings.push(a),a},e.addEraser=function(t){var e=r.default.create({tool:{name:"eraser"},points:t});return this.drawings.push(e),e},e.addText=function(t){var e=t.color,n=u(t,a),r=o.default.create(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach(function(e){c(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({color:{name:e}},n));return this.text.push(r),r},e.refreshDrawings=function(t,e){this._clearCanvas(t),this._drawDrawings(t,e)},e.drawOn=function(t,e){this._drawDrawings(t,e),this._drawText(t,e)},e.cull=function(){this.text.forEach(function(t){return t.cull()}),this.text=this.text.filter(function(t){return!t.isEmpty()})},e.isEmpty=function(){return!this.text.length&&!this.drawings.length},e.toJson=function(){return{_type:this._type,text:this.text.map(function(t){return t.toJson()}),drawings:this.drawings.map(function(t){return t.toJson()}),index:this.index}},e._clearCanvas=function(t){var e=t.canvas,n=e.offsetWidth,r=e.offsetHeight;t.clearRect(0,0,n,r)},e._drawDrawings=function(t,e){this.drawings.filter(function(t){return!t.isCulled}).forEach(function(n){return n.drawOn(t,e)})},e._drawText=function(t,e){this.text.forEach(function(n){return n.drawOn(t,e)})},t}();e.default={create:function(t){return new l(t)}}}}]);
//# sourceMappingURL=877-8b5172d100fb1ef1d722.js.map